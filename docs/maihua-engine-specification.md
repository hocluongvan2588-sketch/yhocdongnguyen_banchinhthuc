Để xây dựng hệ thống Engine Mai Hoa Dịch Số hoạt động chính xác và có khả năng chẩn đoán y lý sâu sắc, Dev team cần triển khai theo cấu trúc 4 module logic dưới đây. Hệ thống này không chỉ dừng lại ở các phép tính chia dư đơn giản mà còn phải xử lý dữ liệu thời gian thực và ma trận ánh xạ y học.1. Module 1: Chuẩn hóa dữ liệu đầu vào (Input Normalization)Phép lập quẻ Tiên thiên dựa hoàn toàn vào Âm lịch và Can Chi. Dev cần tích hợp thư viện chuyển đổi Dương lịch sang Âm lịch (ví dụ: thuật toán của Hồ Ngọc Đức) để lấy các biến số sau:Năm ($Y$): Lấy số thứ tự của Địa chi năm ($Tý = 1, Sửu = 2,..., Hợi = 12$).Tháng ($M$): Số tháng Âm lịch (1 đến 12). Lưu ý: Nếu có tháng nhuận, vẫn tính theo số tháng đó nhưng cần kiểm tra tiết khí để đảm bảo độ chính xác y lý.Ngày ($D$): Số ngày Âm lịch (1 đến 30).Giờ ($H$): Số thứ tự của Địa chi giờ gieo quẻ ($Tý = 1, Sửu = 2,..., Hợi = 12$).2. Module 2: Engine lập quẻ (Hexagram Generation Engine)Triển khai các hàm toán học để xác định Bản quái (quẻ gốc) và Hào động.2.1. Thuật toán xác định Quẻ Thượng và Quẻ HạQuẻ Thượng (Nội quái): $S_{up} = (Y + M + D) \pmod{8}$. Nếu dư $0$, giá trị trả về là $8$ (Quẻ Khôn).Quẻ Hạ (Ngoại quái): $S_{down} = (Y + M + D + H) \pmod{8}$. Nếu dư $0$, giá trị trả về là $8$ (Quẻ Khôn).2.2. Thuật toán xác định Hào động và Quẻ BiếnHào động: $H_{active} = (Y + M + D + H) \pmod{6}$. Nếu dư $0$, hào động là $6$.Logic biến quẻ: Hệ thống phải xác định vị trí hào động (từ dưới lên). Nếu hào đó là Dương ($—$) thì đổi thành Âm ($--$), và ngược lại. Kết quả tạo ra Quẻ Biến, đại diện cho xu hướng diễn tiến của bệnh.2.3. Thuật toán xác định Quẻ Hổ (Mutual Hexagram)Quẻ Hổ cho biết trạng thái trung gian của bệnh tật. Dev lấy các hào từ Quẻ Chủ như sau:Hổ Thượng: Hào 3, 4, 5 của Quẻ Chủ.Hổ Hạ: Hào 2, 3, 4 của Quẻ Chủ.
